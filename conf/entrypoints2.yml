---
entrypoints2:

  - name: app3
    listen: 11111
    server:
      directives:
        - set $variable1 1;
        - set $variable2 2;
      locations:
        - location ~* ^/app1/.+\.(jpg|gif|png)$ { proxy_pass http://backends@app1; }
        - location ~* ^/app2/.+\.(jpg|gif|png)$ { proxy_pass http://backends@app2; }
    location:
      directives:
        - set $variable3 3;
        - set $variable4 4;
    auth:
      request: /auth_stub
    proxy:
      connect_timeout: 100s
      read_timeout: 600s
      protocol: http
    backends:
      - backends@app1
    first:
      backends:
        - backends@app2
    second:
      backends:
        - backends2@app3
