---
test.be:

  - name: test.be:be1
    api:
      - /be1/fun1
      - /be1/fun2
      - /be1/fun3
    dns:
      update: 60s
    server:
      max_conns: 10
      max_fails: 2
      fail_timeout: 30s
    upsync:
      interval: 60s
      timeout: 10s
    servers:
      - server 127.0.0.2:3333 max_conns={{server.max_conns}} max_fails={{server.max_fails}} fail_timeout={{server.fail_timeout}};\n
      - server 127.0.0.2:4444 max_conns={{server.max_conns}} max_fails={{server.max_fails}} fail_timeout={{server.fail_timeout}};

  - name: test.be:be2
    api:
      - /be2/fun1
      - /be2/fun2
      - /be2/fun3
    dns:
      update: 60s
    server:
      max_conns: 10
      max_fails: 2
      fail_timeout: 30s
    upsync:
      interval: 60s
      timeout: 10s
    servers:
      - server 127.0.0.3:3333 max_conns={{server.max_conns}} max_fails={{server.max_fails}} fail_timeout={{server.fail_timeout}};\n
      - server 127.0.0.3:4444 max_conns={{server.max_conns}} max_fails={{server.max_fails}} fail_timeout={{server.fail_timeout}};

test.fe:

  - name: fe1
    listen: 22222
    auth:
      request: /auth_stub
    proxy:
      connect_timeout: 100s
      read_timeout: 600s
      protocol: http
    backends:
      - test.be:be1
      - test.be:be2
